@model IEnumerable<Services>

@{
    ViewBag.Title = "Medical Services Management";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                     
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <style>
         .card-header {
  max-width: fit-content;  
  width: auto;  
  padding: 5px 15px;
            background-color: #E5D9D9;
  margin: -15px auto; 
}

.card-header h2 {
  margin: 0;  
  padding: 5px 0;
                color: #B28989;
            }
    .btn{
       margin-left:15px;
    }
    .btn-add{
            background-color: #B28989;
            color:white;
    }
    .haha{
            background-color: #B28989;
            color: #B28989;
    }
    </style>
</head>
<body>
                 <div class="card">
  <div class="card-header text-black">
                    <h2 class="mb-0">
                        <i class="fas fa-stethoscope"></i> Medical Services Management
                    </h2>
                </div>
 <div class="m-4">
        <div class="row">
            <div class="col-12">


                <!-- Add New Service Button -->
                <button type="button" class="fas fa-plus btn btn-add mb-4 mt-2" data-bs-toggle="modal" data-bs-target="#createServiceModal">
                    Add New Service
                </button>

                <!-- Services Table -->
                @if (Model != null && Model.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead class="haha">
                                <tr>
                                    <th>Medical Service Name</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var service in Model)
                                {
                                    <tr>
                                        <td>@service.MedicalNameService</td>
                                        <td> ₱@service.Price.ToString("F2")</td>
                                        <td>
                                            <a href="javascript:void(0);" class="btn btn-sm btn-warning me-2"
                                               data-bs-toggle="modal" data-bs-target="#editServiceModal"
                                               onclick="populateEditModal(@service.Id, '@service.MedicalNameService', @service.Price)">
                                                Edit
                                            </a>
                                            <a href="@Url.Action("Delete", "MedicalServices", new { id = service.Id })" class="btn btn-sm btn-danger"
                                               onclick="return confirm('Are you sure you want to delete this service?');">Delete</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="alert alert-info" role="alert">
                        <h4 class="alert-heading">No Medical Services Yet</h4>
                        <p>Start by adding your first medical service using the button above.</p>
                    </div>
                }
            </div>
        </div>
    </div>
    </div>
    <!-- Edit Service Modal -->
    <div class="modal fade" id="editServiceModal" tabindex="-1" aria-labelledby="editServiceModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                @using (Html.BeginForm("Edit", "MedicalServices", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()

                    <div class="modal-header">
                        <h5 class="modal-title" id="editServiceModalLabel">Edit Medical Service</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        @if (TempData["SuccessMessage"] != null)
                        {
                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                @TempData["SuccessMessage"]
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        }
                        @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                        <!-- Hidden field for the Service ID -->
                        <input type="hidden" id="ServiceId" name="Id" />

                        <div class="mb-3">
                            <label for="MedicalNameService" class="form-label">Medical Service Name</label>
                            <input type="text" class="form-control" id="MedicalNameService" name="MedicalNameService" required />
                            @Html.ValidationMessage("MedicalNameService", "", new { @class = "text-danger" })
                        </div>

                        <div class="mb-3">
                            <label for="Price" class="form-label">Price</label>
                            <div class="input-group">
                                <span class="input-group-text"> ₱</span>
                                <input type="number" class="form-control" id="Price" name="Price" step="0.01" min="0" required />
                            </div>
                            @Html.ValidationMessage("Price", "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Create Service Modal -->
    <div class="modal fade" id="createServiceModal" tabindex="-1" aria-labelledby="createServiceModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                @using (Html.BeginForm("Create", "MedicalServices", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()

                    <div class="modal-header">
                        <h5 class="modal-title" id="createServiceModalLabel">Create New Medical Service</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        @if (TempData["SuccessMessage"] != null)
                        {
                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                @TempData["SuccessMessage"]
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        }
                        @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                        <div class="mb-3">
                            <label for="MedicalNameService" class="form-label">Medical Service Name</label>
                            @Html.TextBox("MedicalNameService", "", new {
                            @class = "form-control",
                                                @placeholder = "e.g., General Consultation, Blood Test, X-Ray",
                                                @required = "required"
                                                })
                        @Html.ValidationMessage("MedicalNameService", "", new { @class = "text-danger" })
                    </div>

                    <div class="mb-3">
                        <label for="Price" class="form-label">Price</label>
                        <div class="input-group">
                            <span class="input-group-text"> ₱</span>
                            @Html.TextBox("Price", "", new {
                                                        @class = "form-control",
                                                        @type = "number",
                                                        @step = "0.01",
                                                        @min = "0",
                                                        @placeholder = "0.00",
                                                        @required = "required"
                                                        })
                        </div>
                        @Html.ValidationMessage("Price", "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Service</button>
                </div>
                                }
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Clear form when modal is hidden
        document.getElementById('createServiceModal').addEventListener('hidden.bs.modal', function () {
            var form = this.querySelector('form');
            form.reset();

            // Clear validation messages
            var validationMessages = form.querySelectorAll('.text-danger');
            validationMessages.forEach(function(msg) {
                msg.textContent = '';
            });
        });

            function populateEditModal(serviceId, medicalName, price) {
            // Set the values in the modal
            document.getElementById("ServiceId").value = serviceId;
            document.getElementById("MedicalNameService").value = medicalName;
            document.getElementById("Price").value = price.toFixed(2); // Ensure price has 2 decimal places
        }
    </script>
</body>
</html>