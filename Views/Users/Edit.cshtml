@model DCAS.Models.Users

@{
    ViewData["Title"] = "Edit";
}

<style>
    .card-header {
        max-width: fit-content;
        width: auto;
        padding: 5px 15px;
        background-color: #E5D9D9;
        margin: -15px auto;
        border-radius: 5px; 
    }

        .card-header h2 {
            margin: 0;
            padding: 5px 0;
            color: #B28989;
        }

    h2 {
        color: #B28989;
        border-bottom: 1px solid #E5D9D9;
        padding-bottom: 5px;
        margin-top: 20px;
        margin-bottom: 15px;
    }

    .btn-Save { 
        background-color: #E5D9D9;
        color: #B28989;
        border: 1px solid #E5D9D9;
        transition: all 0.2s ease-in-out;
    }

        .btn-Save:hover {
            background-color: #B28989;
            color: white;
        }
</style>

<div class="row">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header text-white">
                <h2 class="mb-0">
                    <i class="fas fa-user-edit"></i> Edit User's Details
                </h2>
            </div>
            <div class="m-4">
                <form asp-action="Edit" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <input type="hidden" asp-for="UsersId" />
                    <input type="hidden" asp-for="Profile" /> @* Keep existing image path as hidden field for preservation * @

                    @* --- PERSONAL INFORMATION SECTION --- *@
                    <h2>Personal Information</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Name" class="control-label"></label>
                                <input asp-for="Name" class="form-control" />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Email" class="control-label"></label>
                                <input asp-for="Email" class="form-control" type="email" /> @* Added type="email" *@
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="PhoneNumber" class="control-label"></label>
                                <input asp-for="PhoneNumber" class="form-control" type="tel" /> @* Added type="tel" *@
                                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Gender" class="control-label"></label>
                                @* CONVERTED TO DROPDOWN *@
                                <select asp-for="Gender" class="form-control">
                                    <option value="">--- Select Gender ---</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                                <span asp-validation-for="Gender" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="BirthDate" class="control-label"></label>
                                <input asp-for="BirthDate" id="BirthDate" class="form-control" type="date" /> @* Added type="date" for date picker *@
                                <span asp-validation-for="BirthDate" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Age" class="control-label"></label>
                                <input asp-for="Age" id="Age" class="form-control" type="number" readonly /> @* Added type="number" and readonly for auto-calc *@
                                <span asp-validation-for="Age" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Nationality" class="control-label"></label>
                                <input asp-for="Nationality" class="form-control" />
                                <span asp-validation-for="Nationality" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                @* Use a non-bound input for the new file upload in Edit view *@
                                <label for="NewImage" class="control-label">Change Profile Image (Optional)</label>
                                <input name="NewImage" type="file" class="form-control" accept="image/*" />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label asp-for="Address" class="control-label"></label>
                                <input asp-for="Address" class="form-control" />
                                <span asp-validation-for="Address" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <hr />

                    @* --- EMPLOYMENT INFORMATION SECTION --- *@
                    <h2>Employment Information</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Role" class="control-label"></label>
                                @* CONVERTED TO DROPDOWN *@
                                <select asp-for="Role" class="form-control">
                                    <option value="">--- Select Role ---</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Staff">Staff</option>
                                </select>
                                <span asp-validation-for="Role" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="JobTitle" class="control-label"></label>
                                <input asp-for="JobTitle" class="form-control" />
                                <span asp-validation-for="JobTitle" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Position" class="control-label"></label>
                                <input asp-for="Position" class="form-control" />
                                <span asp-validation-for="Position" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Specialization" class="control-label"></label>
                                <input asp-for="Specialization" class="form-control" />
                                <span asp-validation-for="Specialization" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="StartDate" class="control-label"></label>
                                <input asp-for="StartDate" class="form-control" type="date" /> @* Added type="date" *@
                                <span asp-validation-for="StartDate" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="WorkStatus" class="control-label"></label>
                                <input asp-for="WorkStatus" class="form-control" />
                                <span asp-validation-for="WorkStatus" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <hr />

                    @* --- ACCOUNT CREDENTIALS SECTION --- *@
                    <h2>Account Credentials</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Username" class="control-label"></label>
                                <input asp-for="Username" class="form-control" />
                                <span asp-validation-for="Username" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="Password" class="control-label"></label>
                                <input asp-for="Password" class="form-control" type="password" /> @* Added type="password" *@
                                <span asp-validation-for="Password" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <div class="form-group mt-4">
                        <input type="submit" value="Save" class="btn btn-Save" />
                        <a asp-action="Index" class="btn btn-secondary ml-2">Back to List</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const birthDateInput = document.getElementById('BirthDate');
            const ageInput = document.getElementById('Age');

            // Function to calculate age
            function calculateAge() {
                const birthDateValue = birthDateInput.value;

                if (birthDateValue) {
                    const birthDate = new Date(birthDateValue);
                    const today = new Date();

                    let age = today.getFullYear() - birthDate.getFullYear();
                    const monthDifference = today.getMonth() - birthDate.getMonth();

                    // Adjust age if the birthday hasn't occurred yet this year
                    if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }

                    // Set the calculated age to the Age input field
                    ageInput.value = age;
                } else {
                    // Clear age if birthdate is empty
                    ageInput.value = '';
                }
            }

            // Execute on change and on load to populate if data exists
            birthDateInput.addEventListener('change', calculateAge);
            calculateAge();
        });
    </script>
}